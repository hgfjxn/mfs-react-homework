
# 代码题

1. 请实现与下面 Generator 函数 等价的迭代器    ```     function* gen(){         yield 1         yield 2         return 3;     }    ```		等价的迭代器：		```javascript	function iter(array){		var index = 0;		return {			next: function(){				hasDone = index >= array.length-1				let val				if(index <= array.length-1){					val = array[index++]				}				return {value: val,	done: hasDone}			}		}	}		function gen(){		return iter([1,2,3])	}	```2. 请给对象 `let obj={}` 加上迭代器，实现其如果迭代返回的是无限 `a` 的序列	```javascript	obj[Symbol.iterator]=function* (){		while(true){			yield "a"		}	}	```3. 请给对象 `obj` 加上迭代器，使其可以像数组一样使用 `for of` 循环    ```     let obj = {         [0] : "a",         [1] : "b",         [2] : "c",         length : 3     }    ```		本题的对象类似数组对象，可以直接使用数组对象的迭代器遍历。加上迭代器后，如下：		```javascript	let obj = {         [0] : "a",         [1] : "b",         [2] : "c",         length : 3,
         [Symbol.iterator]: Array.prototype[Symbol.iterator]
    };
    	 for (let item of obj) {
	       console.log(item)
	}	```4. 请自行封装 `ajaxGet(url)` 函数，其返回值为 Promise ，其中 data 为获取的数据（内部使用 XMLHttpRequest）    * 请利用自己实现的 `ajaxGet(url)` 函数，实现**串行**（一个接一个的）发送10个请求，来获取下面 api 的前10页数据    * 请利用自己实现的 `ajaxGet(url)` 函数，实现**并行**（同时）发送10个请求，来获取下面 api 的前10页数        ```        GET http://api.learning.mafengshe.com/news        参数：pageSize：默认值 30（最大200），每一页的新闻条目数。page：默认 1，当前页码        例如：pageSize=30&page=1 表示获取第一页数据，每页30条数据        ```	自定义`ajaxGet(url)` 函数如下：	```javascript	let XMLHttpRequest = require("xmlhttprequest").XMLHttpRequest;	function ajaxGet(url){		return new Promise(function(resolve, reject){		   	let request = new XMLHttpRequest()			request.onload = function(){				if(request.status ==200){					resolve(request.responseText)   				}else{	   				reject(request)		   		}			}	    			   request.open("GET", url, true)			request.send()		})	}	```		串行请求10个页面：		```javascript	function oneByOne(pageSize, pages){		for(let page = 1; page <= pages; page++){			ajaxGet('http://api.learning.mafengshe.com/news?pageSize='+pageSize+'&page='+page).then(data=> console.log(data), err => console.log("error occoured: ", err))		}	}		oneByOne(1,10)	```		并行请求10个页面：		```javascript    function atOnce(pageSize, pages) {	    var array = []	    for (let page = 1; page <= pages; page++) {	        array.push(ajaxGet('http://api.learning.mafengshe.com/news?pageSize=' + pageSize + '&page=' + page))	    }	    Promise.all(array).then(	        function (gets, err) {	            if (err) {	                console.log(err)	            } else {	                for (let get of gets) {	                    console.log(get)	                }	            }	        }	    )	}		atOnce(1,10)	```	5. 请实现 Generator 函数 `range(start,end)`，可以迭代出`start`到`end`直接所有整数	```javascript	function* range(start, end){		while(start <= end){ // 如果不包括end，去掉等号			yield start			start = start + 1		}	}	```	6. 请实现 Generator 函数 `fib()`，实现计算无限序列：斐波那契数列。并使用解构语法获得 `fib()` 函数计算斐波那契数列前 3 项	```javascript	function* fib(){		var a = 0		var b = 1		while(true){			[a,b] = [b,a+b]			yield a		}	}		[a,b,c] = fib()	```7. 请将 `fs.readFile(path[, options], callback)` 手动函数 Thunk 化，了解函数点击[这里](https://nodejs.org/dist/latest-v8.x/docs/api/fs.html#fs_fs_readfile_path_options_callback)	```javascript	function thunk(path){		return function(callback){			return fs.readFile(path,callback)		}	}	```		简单调用时如下（未做异常处理）：		```javascript	thunk("/Users/guangfuhe/test.ttx")(function(err,data){		console.log(data.toString())	})	```8. 请实现 `thunkify(fn)` 函数，它将一个 callback 类型的异步调用函数转换为 Thunk 函数（此题请自学完成）	例如转换 `fs.readFile`函数：		```javascript	let fs = require('fs')	let thunkify = require('thunkify')	let read = thunkify(fs.readFile)		read('/Users/guangfuhe/test.ttx')(function(err, data){		console.log(data.toString())	})	```9. 请实现基于 Thunk 函数的 Generator 函数自动运行器 （此题请自学完成）		假设Thunk函数定义：		```javascript	function thunk(param){		return function (callback){			...		}	}	```		generator 函数定义如下：		```javascript	function* gen(){		var data = yield thunk(param)		console.log(data)		data = yield thunk(param)		console.log(data)	}	```		自动运行器 函数如下：		```javascript	function run(gen){		var g = gen()				function next(data){//此处参数个数和顺序可能需要调整			var result = g.next(data)			if(result.done) return			result.value(next)//给thunk函数传入回调函数		}				next()	}		run(gen)	```		以读取文件为例的完整例子如下：		```javascript	let fs = require('fs')	function thunk(param){		return function (callback){			fs.readFile(param, callback)		}	}    function* gen(){		var data = yield thunk('/Users/guangfuhe/test.ttx')		console.log(data)		data = yield thunk('/Users/guangfuhe/test.ttx')		console.log(data)	}	function run(gen){		var g = gen()				function next(err, data){			var result = g.next(data)			if(result.done) return			result.value(next)		}				next()	}		run(gen)	```	10. 请实现基于 Promise 的 Generator 函数自动运行器	基于Promise的自动运行器如下：	```javascript	function promise(){		return new Promise(function(resolve, reject){			//处理异步操作，并调用resolve和reject		})	}		function* gen(){		vat data = yield promise()		console.log(data)//processing data		data = yield promise()	}		function run(gen){		var g = gen()				function next(data){			var result = g.next(data)			if(result.done) return result.value			result.value.then(				data => next(data),				err => console.log(err)			)		}				next()	}		run(gen)	```		以读取文件为例，完整的例子如下：		```javascript	let fs = require('fs')	let readFile = function (filepath) {		return new Promise(function (resolve, reject) {			fs.readFile(filepath, function (err, data) {				if (err) reject(err)				resolve(data)			})		})	}	let gen = function* () {		var data = yield readFile('/Users/guangfuhe/test.ttx')		console.log(data)		data = yield readFile('/Users/guangfuhe/test.ttx')		console.log(data)	}	function run(gen) {		var g = gen()		function next(data) {			var result = g.next(data)			if (result.done) return result.value			result.value.then(function (data) {				next(data)			})		}		next()	}	run(gen)	```

